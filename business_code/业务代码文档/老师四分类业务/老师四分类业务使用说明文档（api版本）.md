
# 使用说明文档

## 介绍
该程序用于处理课堂师生对话数据并调用指定模型进行文本分析。通过传递一个包含所有模型参数、数据处理参数、待分析的数据以及其他相关信息的 JSON 对象，程序可以输出处理后的结果并保存为 Excel 文件以及 JSON 文件。

## 函数说明

### `main(params)`
主函数，处理数据并进行分析。函数现在只接受一个包含所有必要参数的 JSON 对象，简化了参数的传递。如果不传递模型相关参数，则只进行数据处理，不调用模型进行分析。

### 参数说明

| 参数名           | 类型   | 是否必需 | 描述                                                                                         |
|------------------|--------|----------|----------------------------------------------------------------------------------------------|
| `params`         | `dict` | 是       | 包含以下所有字段的 JSON 对象，涵盖模型参数、数据处理参数、待分析数据、模型提示语和输出路径等。   |

#### `params` 对象结构说明：

- **`model_parameters`** (可选)：用于配置模型调用的相关参数。如果不传递此参数，脚本只进行数据处理部分，不会调用模型。
    - `model_family` (`str`) (可选)：模型的系列名称，如 "gpt4o"。
    - `api_key` (`str`) (可选)：API 密钥，用于调用模型接口。
    - `model_name` (`str`) (可选)：模型名称，如 "soikit_test"。
    - `api_version` (`str`) (可选)：API 版本信息。
    - `prompt` (`str`) (可选)：模型的提示语，用于指导模型分析输入文本（在函数内部会更新）。
  
    **说明**：如果不传递 `model_parameters`，程序将只进行数据处理，跳过模型分析部分。

- **`data_processor`** (必需)：数据处理相关的参数配置，控制数据处理逻辑。
    - `Task` (`str`) (必需)：任务类型，如 "teacher_dialogue_classification"。
    - `T` (`int`) (必需)：处理相关的时间参数，如 500。

- **`data`** (必需)：待处理的数据，包括开始时间、结束时间、文本和标签。
    - `start_time` (`list`) (必需)：对话片段的开始时间（单位：秒）。
    - `end_time` (`list`) (必需)：对话片段的结束时间（单位：秒）。
    - `text` (`list`) (必需)：对话文本内容。
    - `label` (`list`) (必需)：标签信息（例如 0 表示老师发言，1 表示学生回应）。

- **`prompt`** (必需)：模型分析所使用的提示语。

- **`output_path`** (必需)：结果输出文件的路径（Excel 文件路径）。

### 示例调用

```python
input_json = {
    'model_parameters': {  # 可选
        'model_family': 'gpt4o',
        'api_key': 'b2e709bdd54f4416a734b4a6f8f1c7a0',
        'model_name': 'soikit_test',
        'api_version': '2024-02-01',
        'prompt': ''  # 这个会在 main 函数中更新
    },
    'data_processor': {  # 必需
        'Task': 'teacher_dialogue_classification',
        'T': 500
    },
    'data': {  # 必需
        'start_time': [27300, 35310, 40560, 45590, 47910, 50070, 52780, 53000],
        'end_time': [32940, 39510, 42710, 47190, 49590, 52760, 52790, 69880],
        'text': [
            '具你，為什麼要我買？這是第一套。',
            '喂，你，吃你吃你狗，你，',
            '好，把語文書翻到第50頁，',
            '然後鉛筆收起來把，',
            '課堂練習放到左上角，',
            '先把語文書翻到翻到第50頁，翻到這裡，',
            '沒有，50。我現在這個陽貓世，',
            '我看誰今天坐姿有問題啊啊，'
        ],
        'label': [0, 1, 0, 0, 1, 0, 1, 0]
    },
    'prompt': "後面的'待分析文本'是一段發生在課堂上的師生對話，    其中，'老師話語'是老師說的話，'學生話語'是學生說的話。    有的'待分析文本'沒有采集到'學生話語'...",
    'output_path': '../output.xlsx'
}

main(input_json)
```

### 输出结果
- 程序会生成一个包含分析结果的 JSON 文件以及 Excel 文件。
- JSON 文件的命名规则为：`不同task任务调用闭源模型生成的結果/{Task}_{model_name}_result.json`。
- Excel 文件将保存到 `output_path` 参数指定的路径。

